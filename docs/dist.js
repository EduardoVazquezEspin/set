"use strict";function t(t,e,s,n){return new(s||(s=Promise))((function(i,r){function a(t){try{c(n.next(t))}catch(t){r(t)}}function o(t){try{c(n.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(a,o)}c((n=n.apply(t,e||[])).next())}))}"function"==typeof SuppressedError&&SuppressedError;class e{constructor(t){this.value=t,this.subscribers=[]}get(){return this.value}set(t){this.value=t,this.trigger()}trigger(){this.subscribers.forEach((t=>t(this.value)))}subscribe(t){return this.subscribers.push(t),()=>{this.subscribers=this.subscribers.filter((e=>e!==t))}}subscribeAndRun(t){return this.subscribers.push(t),t(this.value),()=>{this.subscribers=this.subscribers.filter((e=>e!==t))}}}class s{constructor(t){if(3!==t.length)throw new Error("Invalid set length");this.cards=t}getCards(){return this.cards}isValid(){for(let t=0;t<4;t++)if(!this.areThreeCharactersAllEqualOrAllDifferent(this.cards[0][t],this.cards[1][t],this.cards[2][t]))return!1;return!0}areThreeCharactersAllEqualOrAllDifferent(t,e,s){return t===e&&t===s||t!==e&&t!==s&&e!==s}equals(t){return!!t.cards.includes(this.cards[0])&&(!!t.cards.includes(this.cards[1])&&!!t.cards.includes(this.cards[2]))}}class n{static Random(){return`${Math.floor(3*Math.random())}${Math.floor(3*Math.random())}${Math.floor(3*Math.random())}${Math.floor(3*Math.random())}`}static CompressOne(t){const e=3*parseInt(t[0])+parseInt(t[1]),s=3*parseInt(t[2])+parseInt(t[3]);return String.fromCharCode(e+49)+String.fromCharCode(s+49)}static Compress(t){return t.reduce(((t,e)=>t+this.CompressOne(e)),"")}static DeCompressChar(t){let e=t.charCodeAt(0)-49,s=(e%3).toString();return e=Math.floor(e/3),s=(e%3).toString()+s,s}static DeCompress(t){const e=[];for(let s=0;s<t.length/2;s++)e.push(this.DeCompressChar(t[2*s])+this.DeCompressChar(t[2*s+1]));return e}}const i={"PREVENT-NO-SOLUTION":{value:"TRUE",isTruthy:!0},AUDIO:{value:"FALSE",isTruthy:!1},"GAME-ID":{value:"",isTruthy:!1}};class r{constructor(){this.updateUrl=()=>{const t=document.title,e=window.location.origin+window.location.pathname,s={},n=this.dictionary.get(),r=Object.keys(n).filter((t=>n[t].get().value.get()!==i[t].value));r.forEach((t=>s[t]=n[t].get().value.get()));const a=Object.entries(s).reduce(((t,e,s)=>(0!==s&&(t+="&"),t+=e[0]+"="+e[1])),""),o=0===r.length?e:e+"?"+a;window.history.replaceState({},t,o)};const t=new URLSearchParams(window.location.search),s=Object.entries(i);this.dictionary=new e(s.reduce(((s,n)=>{const i=t.get(n[0].toUpperCase());if(null===i)return Object.assign(Object.assign({},s),{[n[0]]:new e({value:new e(n[1].value),isTruthy:new e(n[1].isTruthy)})});const a=i.toUpperCase(),o=r.isStringTruthy.includes(a);return Object.assign(Object.assign({},s),{[n[0]]:new e({value:new e(a),isTruthy:new e(o)})})}),{})),this.dictionary.subscribe(this.updateUrl)}onWindowLoad(){}isFeatureEnabled(t){return this.dictionary.get()[t].get().isTruthy}getFeatureValue(t){return this.dictionary.get()[t].get().value}setFeatureValue(t,e){let s,n;"string"==typeof e?(s=e,n=r.isStringTruthy.includes(s)):(n=e,s=n?"TRUE":"FALSE");const i=this.dictionary,a=i.get()[t],{value:o,isTruthy:c}=a.get();o.set(s),c.set(n),a.trigger(),i.trigger()}}r.isStringTruthy=["T","TRUE","Y","YES","S","SI","SÍ"];const a=["nice","wrong","correct","victory"],o={nice:["nice.mp3"],wrong:["fweeng.wav"],correct:["success.wav"],victory:["victory-1.wav","victory-2.wav"]};class c extends HTMLElement{constructor(){super(),this.color="red",this.root=this.attachShadow({mode:"open"});const t=document.createElement("div");t.setAttribute("class","box"),this.root.appendChild(t),this.setColor("red");const e=document.createElement("style");e.innerText=c.styles,this.root.appendChild(e)}NextColor(){const t=(c.colors.indexOf(this.color)+1)%c.colors.length;this.setColor(c.colors[t])}setColor(t){var e;this.color=t;const s=null===(e=this.shadowRoot)||void 0===e?void 0:e.querySelector("div");null==s||s.setAttribute("class",`box ${t}`)}connectedCallback(){setInterval((()=>this.NextColor()),2e3)}}c.colors=["red","blue","green"],c.styles="\n  .red {\n    background-color: red;\n  }\n\n  .blue {\n    background-color: blue;\n  }\n\n  .green {\n    background-color: green;\n  }\n\n  .box {\n    width: 100px;\n    height: 100px;\n  }\n  ".replaceAll("\n",""),customElements.define("color-square",c);class l extends HTMLElement{constructor(){var t;super(),this.onClick=()=>{const t=this.getAttribute("card-id");if(null===t||!l.isIdValidRegex.test(t))return;getGameManager().toggleCardSelected(t)},this.attributeChangedCallbackIsClicked=t=>{t.isSelected?this.img.setAttribute("class","card clicked"):this.img.setAttribute("class","card")},this.attributeChangedCallbackClickable=t=>{"true"===t?this.img.addEventListener("mouseup",this.onClick):this.img.removeEventListener("mouseup",this.onClick)},this.root=this.attachShadow({mode:"open"}),this.subscriptions=[];const e=document.createElement("style");e.innerText=l.styles,this.root.appendChild(e),this.img=document.createElement("img"),this.img.setAttribute("class","card"),this.img.setAttribute("alt",null!==(t=this.getAttribute("card-id"))&&void 0!==t?t:"Invalid Card"),this.root.appendChild(this.img)}connectedCallback(){const t=this.getAttribute("card-id");if(null===t||!l.isIdValidRegex.test(t))return;const e=getGameManager().getCard(t);if(void 0===e)return;this.subscriptions.forEach((t=>t())),this.subscriptions=[];const s=e.subscribeAndRun(this.attributeChangedCallbackIsClicked);this.subscriptions.push(s)}disconnectedCallback(){this.subscriptions.forEach((t=>t())),this.subscriptions=[]}attributeChangedCallback(t,e,s){if(e!==s)switch(t){case"card-id":this.attributeChangedCallbackCardId(s);break;case"clickable":this.attributeChangedCallbackClickable(s)}}attributeChangedCallbackCardId(t){null!==t&&l.isIdValidRegex.test(t)&&(this.img.src=`./img/${t}.png`,this.img.alt=t)}}l.observedAttributes=["card-id","clickable"],l.styles="\n  .card {\n    width: var(--card-w);\n    height: var(--card-h);\n    border: 1px black solid;\n    border-radius: var(--card-border);\n    box-shadow: 2px 1px 1px black;\n    cursor: pointer;\n  }\n  .clicked {\n    filter: brightness(50%);\n  }\n  ".replaceAll("\n",""),l.isIdValidRegex=/^[0-2]{4}$/,customElements.define("card-displayer",l);class d extends HTMLElement{constructor(){super(),this.renderAllCards=t=>{for(;this.container.lastChild;)this.container.removeChild(this.container.lastChild);t.forEach((t=>{const e=document.createElement("card-displayer");e.setAttribute("card-id",t.id),e.setAttribute("clickable","true"),this.container.appendChild(e)}))},this.root=this.attachShadow({mode:"open"}),this.subscriptions=[];const t=document.createElement("style");t.innerText=d.styles,this.root.appendChild(t),this.container=document.createElement("div"),this.container.setAttribute("class","container"),this.root.appendChild(this.container)}connectedCallback(){const t=getGameManager().getCards();this.subscriptions.forEach((t=>t())),this.subscriptions=[];const e=t.subscribeAndRun((t=>{const e=t.map((t=>t.get()));this.renderAllCards(e)}));this.subscriptions.push(e)}disconnectedCallBack(){this.subscriptions.forEach((t=>t())),this.subscriptions=[]}}d.styles="\n  .container {\n    display: grid;\n    grid-template-columns: var(--card-w) var(--card-w) var(--card-w);\n    grid-gap: 10px;\n    padding: 10px;\n  \n  }\n  ".replaceAll("\n",""),customElements.define("board-displayer",d);class h extends HTMLElement{constructor(){super(),this.root=this.attachShadow({mode:"open"}),this.subscriptions=[];const t=document.createElement("style");t.innerText=h.styles,this.root.appendChild(t),this.container=document.createElement("div"),this.container.setAttribute("class","container"),this.root.appendChild(this.container);const e=document.createElement("board-displayer");this.container.appendChild(e);const s=document.createElement("div");s.setAttribute("class","menu"),this.container.appendChild(s),this.totalSetsP=document.createElement("p"),s.appendChild(this.totalSetsP);const n=document.createElement("found-sets-displayer");s.appendChild(n);const i=document.createElement("play-again-button");s.appendChild(i)}connectedCallback(){const t=getGameManager().getSets();this.subscriptions.forEach((t=>t())),this.subscriptions=[];const e=t.subscribeAndRun((t=>{this.totalSetsP.innerText=`${t.length} SETS`}));this.subscriptions.push(e)}disconnectedCallback(){this.subscriptions.forEach((t=>t())),this.subscriptions=[]}attributeChangedCallback(t,e,s){}}h.observedAttributes=["card-array"],h.styles="\n  * {\n    font-family: MightySouly;\n    font-size: 48px;\n\n    margin: 0;\n    padding: 0;\n  }\n  .container {\n    display: flex;\n    flex-direction: row;\n  }\n  p {\n    margin: 5px;\n    width: 100%;\n    max-width: calc(3 * var(--mini-card-w));\n    text-align: center;\n  }\n  ".replaceAll("\n",""),customElements.define("game-displayer",h);class u extends HTMLElement{constructor(){super(),this.root=this.attachShadow({mode:"open"}),this.subscriptions=[];const t=document.createElement("style");t.innerHTML=u.styles,this.root.appendChild(t),this.container=document.createElement("div"),this.container.setAttribute("class","container"),this.root.appendChild(this.container)}connectedCallback(){const t=getGameManager().getFoundSets();this.subscriptions.forEach((t=>t())),this.subscriptions=[];const e=t.subscribeAndRun((t=>{for(;null!==this.container.lastChild;)this.container.removeChild(this.container.lastChild);t.forEach((t=>{t.getCards().forEach((t=>{const e=document.createElement("img");e.src=`./img/${t}R.png`,e.alt=t+"R",e.setAttribute("class","card"),this.container.appendChild(e)}))}))}));this.subscriptions.push(e)}disconnectedCallback(){this.subscriptions.forEach((t=>t())),this.subscriptions=[]}attributeChangedCallback(t,e,s){}}u.styles="\n  .container {\n    display: grid;\n    grid-template-columns: var(--mini-card-w) var(--mini-card-w) var(--mini-card-w);\n    grid-gap: 3px;\n    padding: 5px;\n  }\n\n  .card {\n    width: var(--mini-card-w);\n    height: var(--mini-card-h);\n    border: 1px black solid;\n    border-radius: var(--card-border);\n    box-shadow: 2px 1px 1px black;\n  }\n\n  button{\n    width: max-content;\n    height: max-content;\n  }\n  ".replaceAll("\n",""),customElements.define("found-sets-displayer",u);class p extends HTMLElement{constructor(){super(),this.renderPlayAgainButton=()=>{this.button=document.createElement("button"),this.button.innerHTML="You won!<br>Start again?",this.button.className="play-button",this.button.onmouseup=()=>{getGameManager().initGame()},this.root.appendChild(this.button)},this.root=this.attachShadow({mode:"open"}),this.subscriptions=[];const t=document.createElement("style");t.innerText=p.styles,this.root.appendChild(t);const e=getGameManager(),s=e.getSets(),n=e.getFoundSets().subscribeAndRun((t=>{void 0!==this.button&&(this.root.removeChild(this.button),this.button=void 0),t.length===s.get().length&&this.renderPlayAgainButton()}));this.subscriptions.push(n)}connectedCallback(){}disconnectedCallback(){this.subscriptions.forEach((t=>t())),this.subscriptions=[]}attributeChangedCallback(t,e,s){}}p.styles='\n  * {\n    font-family: MightySouly;\n    font-size: 32px;\n\n    margin: 0;\n    padding: 0;\n  }\n  .play-button {\n    background-color: #3DD1E7;\n    border: 0 solid #E5E7EB;\n    box-sizing: border-box;\n    color: #000000;\n    display: flex;\n    font-family: ui-sans-serif,system-ui,-apple-system,system-ui,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";\n    font-size: 1rem;\n    font-weight: 700;\n    justify-content: center;\n    line-height: 1.75rem;\n    padding: .75rem 1.65rem;\n    position: relative;\n    text-align: center;\n    text-decoration: none #000000 solid;\n    text-decoration-thickness: auto;\n    width: 100%;\n    max-width: calc(3 * var(--mini-card-w));\n    margin: 11px;\n    position: relative;\n    cursor: pointer;\n    transform: rotate(-2deg);\n    user-select: none;\n    -webkit-user-select: none;\n    touch-action: manipulation;\n  }\n  \n  .play-button:focus {\n    outline: 0;\n  }\n  \n  .play-button:after {\n    content: \'\';\n    position: absolute;\n    border: 1px solid #000000;\n    bottom: 4px;\n    left: 4px;\n    width: calc(100% - 1px);\n    height: calc(100% - 1px);\n  }\n  \n  .play-button:hover:after {\n    bottom: 2px;\n    left: 2px;\n  }\n  \n  @media (min-width: 768px) {\n    .play-button {\n      padding: .75rem 3rem;\n      font-size: 1.25rem;\n    }\n  }\n  '.replaceAll("\n",""),customElements.define("play-again-button",p);const g=new r;globalThis.getFeaturesManager=()=>g;const b=new class{constructor(t){this.loadClip=t=>{o[t].forEach((e=>{const s=document.createElement("audio"),n=document.createElement("source");n.setAttribute("src","audio/"+e),n.setAttribute("type","audio/mpeg"),s.appendChild(n),document.body.appendChild(s),this.audioClip[t].push(s)}))},this.featuresManager=t,this.audioClip={},a.forEach((t=>this.audioClip[t]=[]))}onWindowLoad(){a.forEach(this.loadClip)}play(t){if(!this.featuresManager.isFeatureEnabled("AUDIO").get())return;const e=this.audioClip[t],s=e[Math.floor(e.length*Math.random())].cloneNode(!0);document.body.appendChild(s),s.addEventListener("ended",(()=>{document.body.removeChild(s)})),s.play()}}(g);globalThis.getAudioManager=()=>b;const m=new class{constructor(t,s){this.updateFeatureFlag=()=>{const t=this.cards.get().map((t=>t.get().id)),e=n.Compress(t);this.featuresManager.setFeatureValue("GAME-ID",e)},this.featuresManager=t,this.audioManager=s,this.cards=new e([]),this.sets=new e([]),this.foundSets=new e([]),this.cards.subscribe(this.updateFeatureFlag);const i=this.featuresManager.getFeatureValue("GAME-ID").get();if(""===i)this.initGame();else{const t=n.DeCompress(i);this.loadGame(t)}}onWindowLoad(){}initGame(){let t=[],e=[];const s=this.featuresManager.isFeatureEnabled("PREVENT-NO-SOLUTION").get();do{for(t=[];t.length<12;){const e=n.Random();t.every((t=>t!==e))&&t.push(e)}e=this.calculateAllSets(t)}while(s&&0===e.length);this.loadGame(t,e)}loadGame(t,s){const n=t.map((t=>new e({id:t,isSelected:!1})));s=null!=s?s:this.calculateAllSets(t),this.sets.set(s),this.foundSets.set([]),this.cards.set(n)}getCards(){return this.cards}getCard(t){return this.cards.get().find((e=>e.get().id===t))}getSets(){return this.sets}getFoundSets(){return this.foundSets}toggleCardSelected(t){const e=this.cards.get().find((e=>e.get().id===t));void 0!==e&&(e.set({id:t,isSelected:!e.get().isSelected}),this.checkVictory())}checkVictory(){return t(this,void 0,void 0,(function*(){yield new Promise((t=>setTimeout(t,10)));const t=this.cards.get().filter((t=>t.get().isSelected)),e=t.map((t=>t.get().id));if(3!==e.length)return;const n=new s(e);return t.forEach((t=>t.set({id:t.get().id,isSelected:!1}))),n.isValid()?this.foundSets.get().some((t=>t.equals(n)))?(this.audioManager.play("wrong"),void alert("Already found")):(this.foundSets.set([...this.foundSets.get(),n]),void(this.foundSets.get().length===this.sets.get().length?this.audioManager.play("victory"):this.audioManager.play("correct"))):(this.audioManager.play("wrong"),void alert("Wrong"))}))}calculateAllSets(t){const e=[];for(let n=0;n<t.length-2;n++)for(let i=n+1;i<t.length-1;i++)for(let r=i+1;r<t.length;r++){const a=new s([t[n],t[i],t[r]]);a.isValid()&&e.push(a)}return e}}(g,b);globalThis.getGameManager=()=>m,window.onload=function(){g.onWindowLoad(),b.onWindowLoad(),m.onWindowLoad()};
//# sourceMappingURL=dist.js.map
