"use strict";function t(t,e,n,s){return new(n||(n=Promise))((function(i,r){function a(t){try{c(s.next(t))}catch(t){r(t)}}function o(t){try{c(s.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,o)}c((s=s.apply(t,e||[])).next())}))}"function"==typeof SuppressedError&&SuppressedError;class e{constructor(t){this.value=t,this.subscribers=[]}get(){return this.value}set(t){this.value=t,this.trigger()}trigger(){this.subscribers.forEach((t=>t(this.value)))}subscribe(t){return this.subscribers.push(t),()=>{this.subscribers=this.subscribers.filter((e=>e!==t))}}subscribeAndRun(t){return this.subscribers.push(t),t(this.value),()=>{this.subscribers=this.subscribers.filter((e=>e!==t))}}}class n{constructor(t){if(3!==t.length)throw new Error("Invalid set length");this.cards=t}getCards(){return this.cards}isValid(){for(let t=0;t<4;t++)if(!this.areThreeCharactersAllEqualOrAllDifferent(this.cards[0][t],this.cards[1][t],this.cards[2][t]))return!1;return!0}areThreeCharactersAllEqualOrAllDifferent(t,e,n){return t===e&&t===n||t!==e&&t!==n&&e!==n}equals(t){return!!t.cards.includes(this.cards[0])&&(!!t.cards.includes(this.cards[1])&&!!t.cards.includes(this.cards[2]))}}class s{static Random(){return`${Math.floor(3*Math.random())}${Math.floor(3*Math.random())}${Math.floor(3*Math.random())}${Math.floor(3*Math.random())}`}static CompressOne(t){const e=3*parseInt(t[0])+parseInt(t[1]),n=3*parseInt(t[2])+parseInt(t[3]);return String.fromCharCode(e+49)+String.fromCharCode(n+49)}static Compress(t){return t.reduce(((t,e)=>t+this.CompressOne(e)),"")}static DeCompressChar(t){let e=t.charCodeAt(0)-49,n=(e%3).toString();return e=Math.floor(e/3),n=(e%3).toString()+n,n}static DeCompress(t){const e=[];for(let n=0;n<t.length/2;n++)e.push(this.DeCompressChar(t[2*n])+this.DeCompressChar(t[2*n+1]));return e}}const i={"PREVENT-NO-SOLUTION":{value:"TRUE",isTruthy:!0},AUDIO:{value:"FALSE",isTruthy:!1},"GAME-ID":{value:"",isTruthy:!1}};class r{constructor(){this.updateUrl=()=>{const t=document.title,e=window.location.origin+window.location.pathname,n={},s=this.dictionary.get(),r=Object.keys(s).filter((t=>s[t].get().value.get()!==i[t].value));r.forEach((t=>n[t]=s[t].get().value.get()));const a=Object.entries(n).reduce(((t,e,n)=>(0!==n&&(t+="&"),t+=e[0]+"="+e[1])),""),o=0===r.length?e:e+"?"+a;window.history.replaceState({},t,o)};const t=new URLSearchParams(window.location.search),n=Object.entries(i);this.dictionary=new e(n.reduce(((n,s)=>{const i=t.get(s[0].toUpperCase());if(null===i)return Object.assign(Object.assign({},n),{[s[0]]:new e({value:new e(s[1].value),isTruthy:new e(s[1].isTruthy)})});const a=i.toUpperCase(),o=r.isStringTruthy.includes(a);return Object.assign(Object.assign({},n),{[s[0]]:new e({value:new e(a),isTruthy:new e(o)})})}),{})),this.dictionary.subscribe(this.updateUrl)}onWindowLoad(){}isFeatureEnabled(t){return this.dictionary.get()[t].get().isTruthy}getFeatureValue(t){return this.dictionary.get()[t].get().value}setFeatureValue(t,e){let n,s;"string"==typeof e?(n=e,s=r.isStringTruthy.includes(n)):(s=e,n=s?"TRUE":"FALSE");const i=this.dictionary,a=i.get()[t],{value:o,isTruthy:c}=a.get();o.set(n),c.set(s),a.trigger(),i.trigger()}}r.isStringTruthy=["T","TRUE","Y","YES","S","SI","SÃ"];const a=["nice","wrong","correct","victory"],o={nice:["nice.mp3"],wrong:["fweeng.wav"],correct:["success.wav"],victory:["victory-1.wav","victory-2.wav"]};class c extends HTMLElement{constructor(){var t;super(),this.onClick=()=>{const t=this.getAttribute("card-id");if(null===t||!c.isIdValidRegex.test(t))return;getGameManager().toggleCardSelected(t)},this.attributeChangedCallbackIsClicked=t=>{t.isSelected?this.img.setAttribute("class","card clicked"):this.img.setAttribute("class","card")},this.attributeChangedCallbackClickable=t=>{"true"===t?this.img.addEventListener("mouseup",this.onClick):this.img.removeEventListener("mouseup",this.onClick)},this.root=this.attachShadow({mode:"open"}),this.subscriptions=[];const e=document.createElement("style");e.innerText=c.styles,this.root.appendChild(e),this.img=document.createElement("img"),this.img.setAttribute("class","card"),this.img.setAttribute("alt",null!==(t=this.getAttribute("card-id"))&&void 0!==t?t:"Invalid Card"),this.root.appendChild(this.img)}connectedCallback(){const t=this.getAttribute("card-id");if(null===t||!c.isIdValidRegex.test(t))return;const e=getGameManager().getCard(t);if(void 0===e)return;this.subscriptions.forEach((t=>t())),this.subscriptions=[];const n=e.subscribeAndRun(this.attributeChangedCallbackIsClicked);this.subscriptions.push(n)}disconnectedCallback(){this.subscriptions.forEach((t=>t())),this.subscriptions=[]}attributeChangedCallback(t,e,n){if(e!==n)switch(t){case"card-id":this.attributeChangedCallbackCardId(n);break;case"clickable":this.attributeChangedCallbackClickable(n)}}attributeChangedCallbackCardId(t){null!==t&&c.isIdValidRegex.test(t)&&(this.img.src=`./img/${t}.png`,this.img.alt=t)}}c.observedAttributes=["card-id","clickable"],c.styles="\n  .card {\n    width: var(--card-w);\n    height: var(--card-h);\n    border: 1px black solid;\n    border-radius: var(--card-border);\n    box-shadow: 2px 1px 1px black;\n    cursor: pointer;\n  }\n  .clicked {\n    filter: brightness(50%);\n  }\n  ".replaceAll("\n",""),c.isIdValidRegex=/^[0-2]{4}$/,customElements.define("card-displayer",c);class l extends HTMLElement{constructor(){super(),this.renderAllCards=t=>{for(;this.container.lastChild;)this.container.removeChild(this.container.lastChild);t.forEach((t=>{const e=document.createElement("card-displayer");e.setAttribute("card-id",t.id),e.setAttribute("clickable","true"),this.container.appendChild(e)}))},this.root=this.attachShadow({mode:"open"}),this.subscriptions=[];const t=document.createElement("style");t.innerText=l.styles,this.root.appendChild(t),this.container=document.createElement("div"),this.container.setAttribute("class","container"),this.root.appendChild(this.container)}connectedCallback(){const t=getGameManager().getCards();this.subscriptions.forEach((t=>t())),this.subscriptions=[];const e=t.subscribeAndRun((t=>{const e=t.map((t=>t.get()));this.renderAllCards(e)}));this.subscriptions.push(e)}disconnectedCallBack(){this.subscriptions.forEach((t=>t())),this.subscriptions=[]}}l.styles="\n  .container {\n    display: grid;\n    grid-template-columns: var(--card-w) var(--card-w) var(--card-w);\n    grid-gap: 10px;\n    padding: 10px;\n  \n  }\n  ".replaceAll("\n",""),customElements.define("board-displayer",l);class d extends HTMLElement{constructor(){super(),this.root=this.attachShadow({mode:"open"}),this.subscriptions=[];const t=document.createElement("style");t.innerText=d.styles,this.root.appendChild(t),this.container=document.createElement("div"),this.container.setAttribute("class","container"),this.root.appendChild(this.container);const e=document.createElement("board-displayer");this.container.appendChild(e);const n=document.createElement("div");n.setAttribute("class","menu"),this.container.appendChild(n),this.totalSetsP=document.createElement("p"),n.appendChild(this.totalSetsP);const s=document.createElement("found-sets-displayer");n.appendChild(s);const i=document.createElement("play-again-button");n.appendChild(i)}connectedCallback(){const t=getGameManager().getSets();this.subscriptions.forEach((t=>t())),this.subscriptions=[];const e=t.subscribeAndRun((t=>{this.totalSetsP.innerText=`${t.length} SETS`}));this.subscriptions.push(e)}disconnectedCallback(){this.subscriptions.forEach((t=>t())),this.subscriptions=[]}attributeChangedCallback(t,e,n){}}d.styles="\n  * {\n    font-family: MightySouly;\n    font-size: 48px;\n\n    margin: 0;\n    padding: 0;\n  }\n  .container {\n    display: flex;\n    flex-direction: row;\n  }\n  p {\n    margin: 5px;\n    width: 100%;\n    max-width: calc(3 * var(--mini-card-w));\n    text-align: center;\n  }\n  ".replaceAll("\n",""),customElements.define("game-displayer",d);class h extends HTMLElement{constructor(){super(),this.root=this.attachShadow({mode:"open"}),this.subscriptions=[];const t=document.createElement("style");t.innerHTML=h.styles,this.root.appendChild(t),this.container=document.createElement("div"),this.container.setAttribute("class","container"),this.root.appendChild(this.container)}connectedCallback(){const t=getGameManager().getFoundSets();this.subscriptions.forEach((t=>t())),this.subscriptions=[];const e=t.subscribeAndRun((t=>{for(;null!==this.container.lastChild;)this.container.removeChild(this.container.lastChild);t.forEach((t=>{t.getCards().forEach((t=>{const e=document.createElement("img");e.src=`./img/${t}R.png`,e.alt=t+"R",e.setAttribute("class","card"),this.container.appendChild(e)}))}))}));this.subscriptions.push(e)}disconnectedCallback(){this.subscriptions.forEach((t=>t())),this.subscriptions=[]}attributeChangedCallback(t,e,n){}}h.styles="\n  .container {\n    display: grid;\n    grid-template-columns: var(--mini-card-w) var(--mini-card-w) var(--mini-card-w);\n    grid-gap: 3px;\n    padding: 5px;\n  }\n\n  .card {\n    width: var(--mini-card-w);\n    height: var(--mini-card-h);\n    border: 1px black solid;\n    border-radius: var(--card-border);\n    box-shadow: 2px 1px 1px black;\n  }\n\n  button{\n    width: max-content;\n    height: max-content;\n  }\n  ".replaceAll("\n",""),customElements.define("found-sets-displayer",h);class u extends HTMLElement{constructor(){super(),this.renderPlayAgainButton=()=>{this.button=document.createElement("button"),this.button.innerHTML="You won!<br>Start again?",this.button.className="play-button",this.button.onmouseup=()=>{getGameManager().initGame()},this.root.appendChild(this.button)},this.root=this.attachShadow({mode:"open"}),this.subscriptions=[];const t=document.createElement("style");t.innerText=u.styles,this.root.appendChild(t);const e=getGameManager(),n=e.getSets(),s=e.getFoundSets().subscribeAndRun((t=>{void 0!==this.button&&(this.root.removeChild(this.button),this.button=void 0),t.length===n.get().length&&this.renderPlayAgainButton()}));this.subscriptions.push(s)}connectedCallback(){}disconnectedCallback(){this.subscriptions.forEach((t=>t())),this.subscriptions=[]}attributeChangedCallback(t,e,n){}}u.styles='\n  * {\n    font-family: MightySouly;\n    font-size: 32px;\n\n    margin: 0;\n    padding: 0;\n  }\n  .play-button {\n    background-color: #3DD1E7;\n    border: 0 solid #E5E7EB;\n    box-sizing: border-box;\n    color: #000000;\n    display: flex;\n    font-family: ui-sans-serif,system-ui,-apple-system,system-ui,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";\n    font-size: 1rem;\n    font-weight: 700;\n    justify-content: center;\n    line-height: 1.75rem;\n    padding: .75rem 1.65rem;\n    position: relative;\n    text-align: center;\n    text-decoration: none #000000 solid;\n    text-decoration-thickness: auto;\n    width: 100%;\n    max-width: calc(3 * var(--mini-card-w));\n    margin: 11px;\n    position: relative;\n    cursor: pointer;\n    transform: rotate(-2deg);\n    user-select: none;\n    -webkit-user-select: none;\n    touch-action: manipulation;\n  }\n  \n  .play-button:focus {\n    outline: 0;\n  }\n  \n  .play-button:after {\n    content: \'\';\n    position: absolute;\n    border: 1px solid #000000;\n    bottom: 4px;\n    left: 4px;\n    width: calc(100% - 1px);\n    height: calc(100% - 1px);\n  }\n  \n  .play-button:hover:after {\n    bottom: 2px;\n    left: 2px;\n  }\n  \n  @media (min-width: 768px) {\n    .play-button {\n      padding: .75rem 3rem;\n      font-size: 1.25rem;\n    }\n  }\n  '.replaceAll("\n",""),customElements.define("play-again-button",u);class g extends HTMLElement{constructor(){var t;super(),this.onClick=()=>{getErrorManager().closeErrorDialog()},this.root=this.attachShadow({mode:"open"});const e=document.createElement("div");e.className="container",e.addEventListener("click",this.onClick),this.root.appendChild(e);const n=document.createElement("style");n.innerText=g.styles,this.root.appendChild(n),this.dialog=document.createElement("dialog"),this.dialog.innerHTML=null!==(t=this.getAttribute("error-message"))&&void 0!==t?t:"",this.dialog.setAttribute("open","true"),this.dialog.addEventListener("click",this.onClick),this.root.appendChild(this.dialog)}connectedCallback(){}disconnectedCallback(){}attributeChangedCallback(t,e,n){e!==n&&this.renderDialog()}renderDialog(){var t,e,n,s;const i=null!==(t=this.getAttribute("title"))&&void 0!==t?t:"",r=null!==(e=this.getAttribute("message"))&&void 0!==e?e:"",a=null!==(s=null===(n=this.getAttribute("cards"))||void 0===n?void 0:n.split(","))&&void 0!==s?s:[];this.dialog.innerHTML=`\n      <h1 style="margin-bottom: 15px;">${i}</h1>\n      ${a.map((t=>`\n        <img src = './img/${t}R.png' alt='${t}R' class='card'>\n        `.replaceAll("\n",""))).join("")}\n      <p style="margin-top: 10px;">${r}</p>\n    `.replaceAll("\n","")}}g.observedAttributes=["title","message","cards"],g.styles="\n  * {\n    margin: 0;\n    padding; 0;\n\n    text-align: center;\n  }\n  .container{\n    position: fixed;\n    top: 0%;\n    left: 0%;\n    width: 100%;\n    height: 100%;\n    background-color: #00000050;\n  }\n  dialog{\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n  }\n  .card {\n    width: var(--mini-card-w);\n    height: var(--mini-card-h);\n    border: 1px black solid;\n    border-radius: var(--card-border);\n    box-shadow: 2px 1px 1px black;\n  }\n  ".replaceAll("\n",""),customElements.define("error-dialog",g);const p=new r;globalThis.getFeaturesManager=()=>p;const m=new class{constructor(t){this.loadClip=t=>{o[t].forEach((e=>{const n=document.createElement("audio"),s=document.createElement("source");s.setAttribute("src","audio/"+e),s.setAttribute("type","audio/mpeg"),n.appendChild(s),document.body.appendChild(n),this.audioClip[t].push(n)}))},this.featuresManager=t,this.audioClip={},a.forEach((t=>this.audioClip[t]=[]))}onWindowLoad(){a.forEach(this.loadClip)}play(t){if(!this.featuresManager.isFeatureEnabled("AUDIO").get())return;const e=this.audioClip[t],n=e[Math.floor(e.length*Math.random())].cloneNode(!0);document.body.appendChild(n),n.addEventListener("ended",(()=>{document.body.removeChild(n)})),n.play()}}(p);globalThis.getAudioManager=()=>m;const b=new class{onWindowLoad(){}displayError(t,e,n){this.errorDialog=document.createElement("error-dialog"),this.errorDialog.setAttribute("title",t),this.errorDialog.setAttribute("message",e),this.errorDialog.setAttribute("cards",n.join(",")),document.body.appendChild(this.errorDialog)}closeErrorDialog(){void 0!==this.errorDialog&&(document.body.removeChild(this.errorDialog),this.errorDialog=void 0)}};globalThis.getErrorManager=()=>b;const f=new class{constructor(t,n,i){this.updateFeatureFlag=()=>{const t=this.cards.get().map((t=>t.get().id)),e=s.Compress(t);this.featuresManager.setFeatureValue("GAME-ID",e)},this.featuresManager=t,this.audioManager=n,this.errorManager=i,this.cards=new e([]),this.sets=new e([]),this.foundSets=new e([]),this.cards.subscribe(this.updateFeatureFlag);const r=this.featuresManager.getFeatureValue("GAME-ID").get();if(""===r)this.initGame();else{const t=s.DeCompress(r);this.loadGame(t)}}onWindowLoad(){}initGame(){let t=[],e=[];const n=this.featuresManager.isFeatureEnabled("PREVENT-NO-SOLUTION").get();do{for(t=[];t.length<12;){const e=s.Random();t.every((t=>t!==e))&&t.push(e)}e=this.calculateAllSets(t)}while(n&&0===e.length);this.loadGame(t,e)}loadGame(t,n){const s=t.map((t=>new e({id:t,isSelected:!1})));n=null!=n?n:this.calculateAllSets(t),this.sets.set(n),this.foundSets.set([]),this.cards.set(s)}getCards(){return this.cards}getCard(t){return this.cards.get().find((e=>e.get().id===t))}getSets(){return this.sets}getFoundSets(){return this.foundSets}toggleCardSelected(t){const e=this.cards.get().find((e=>e.get().id===t));void 0!==e&&(e.set({id:t,isSelected:!e.get().isSelected}),this.checkVictory())}checkVictory(){return t(this,void 0,void 0,(function*(){yield new Promise((t=>setTimeout(t,10)));const t=this.cards.get().filter((t=>t.get().isSelected)),e=t.map((t=>t.get().id));if(3!==e.length)return;const s=new n(e);return t.forEach((t=>t.set({id:t.get().id,isSelected:!1}))),s.isValid()?this.foundSets.get().some((t=>t.equals(s)))?(this.audioManager.play("wrong"),void this.errorManager.displayError("Already found","You have found these cards already",e)):(this.foundSets.set([...this.foundSets.get(),s]),void(this.foundSets.get().length===this.sets.get().length?this.audioManager.play("victory"):this.audioManager.play("correct"))):(this.audioManager.play("wrong"),void this.errorManager.displayError("Wrong","These cards do not form a set",e))}))}calculateAllSets(t){const e=[];for(let s=0;s<t.length-2;s++)for(let i=s+1;i<t.length-1;i++)for(let r=i+1;r<t.length;r++){const a=new n([t[s],t[i],t[r]]);a.isValid()&&e.push(a)}return e}}(p,m,b);globalThis.getGameManager=()=>f,window.onload=function(){p.onWindowLoad(),m.onWindowLoad(),f.onWindowLoad()};
//# sourceMappingURL=dist.js.map
