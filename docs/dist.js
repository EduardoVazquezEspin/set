"use strict";function t(t,e,n,s){return new(n||(n=Promise))((function(i,r){function a(t){try{l(s.next(t))}catch(t){r(t)}}function o(t){try{l(s.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,o)}l((s=s.apply(t,e||[])).next())}))}"function"==typeof SuppressedError&&SuppressedError;class e{constructor(t){this.value=t,this.subscribers=[]}get(){return this.value}set(t){this.value=t,this.trigger()}trigger(){this.subscribers.forEach((t=>t(this.value)))}subscribe(t){return this.subscribers.push(t),()=>{this.subscribers=this.subscribers.filter((e=>e!==t))}}subscribeAndRun(t){return this.subscribers.push(t),t(this.value),()=>{this.subscribers=this.subscribers.filter((e=>e!==t))}}}class n{constructor(t){if(3!==t.length)throw new Error("Invalid set length");this.cards=t}getCards(){return this.cards}isValid(){for(let t=0;t<4;t++)if(!this.areThreeCharactersAllEqualOrAllDifferent(this.cards[0][t],this.cards[1][t],this.cards[2][t]))return!1;return!0}areThreeCharactersAllEqualOrAllDifferent(t,e,n){return t===e&&t===n||t!==e&&t!==n&&e!==n}equals(t){return!!t.cards.includes(this.cards[0])&&(!!t.cards.includes(this.cards[1])&&!!t.cards.includes(this.cards[2]))}}class s{static Random(){return`${Math.floor(3*Math.random())}${Math.floor(3*Math.random())}${Math.floor(3*Math.random())}${Math.floor(3*Math.random())}`}static CompressOne(t){const e=3*parseInt(t[0])+parseInt(t[1]),n=3*parseInt(t[2])+parseInt(t[3]);return String.fromCharCode(e+49)+String.fromCharCode(n+49)}static Compress(t){return t.reduce(((t,e)=>t+this.CompressOne(e)),"")}static DeCompressChar(t){let e=t.charCodeAt(0)-49,n=(e%3).toString();return e=Math.floor(e/3),n=(e%3).toString()+n,n}static DeCompress(t){const e=[];for(let n=0;n<t.length/2;n++)e.push(this.DeCompressChar(t[2*n])+this.DeCompressChar(t[2*n+1]));return e}}class i{static CreateCardImg(t,{isReversed:e=!1}={}){const n=document.createElement("img");return i.UpdateCardImg(n,t,{isReversed:e}),n}static UpdateCardImg(t,e,{isReversed:n=!1}={}){const s=e+(n?"R":""),i=`./img/${s}.png`;t.src=i,t.setAttribute("class","card"),t.setAttribute("alt",s)}}i.CardImgStyle="\n  .card {\n    width: var(--card-w);\n    height: var(--card-h);\n    border: 1px black solid;\n    border-radius: var(--card-border);\n    box-shadow: 2px 1px 1px black;\n    cursor: pointer;\n  }\n    ".replaceAll("\n",""),i.ReversedCardImgStyle=(t=1)=>`\n  .card {\n    width: calc(${t} * var(--mini-card-w));\n    height: calc(${t} * var(--mini-card-h));\n    border: 1px black solid;\n    border-radius: calc(${t} * var(--card-border));\n    box-shadow: 2px 1px 1px black;\n  }\n    `.replaceAll("\n","");const r={"PREVENT-NO-SOLUTION":{value:"TRUE",isTruthy:!0},AUDIO:{value:"FALSE",isTruthy:!1},"GAME-ID":{value:"",isTruthy:!1}};class a{constructor(){this.updateUrl=()=>{const t=document.title,e=window.location.origin+window.location.pathname,n={},s=this.dictionary.get(),i=Object.keys(s).filter((t=>s[t].get().value.get()!==r[t].value));i.forEach((t=>n[t]=s[t].get().value.get()));const a=Object.entries(n).reduce(((t,e,n)=>(0!==n&&(t+="&"),t+=e[0]+"="+e[1])),""),o=0===i.length?e:e+"?"+a;window.history.replaceState({},t,o)};const t=new URLSearchParams(window.location.search),n=Object.entries(r);this.dictionary=new e(n.reduce(((n,s)=>{const i=t.get(s[0].toUpperCase());if(null===i)return Object.assign(Object.assign({},n),{[s[0]]:new e({value:new e(s[1].value),isTruthy:new e(s[1].isTruthy)})});const r=i.toUpperCase(),o=a.isStringTruthy.includes(r);return Object.assign(Object.assign({},n),{[s[0]]:new e({value:new e(r),isTruthy:new e(o)})})}),{})),this.dictionary.subscribe(this.updateUrl)}onWindowLoad(){}isFeatureEnabled(t){return this.dictionary.get()[t].get().isTruthy}getFeatureValue(t){return this.dictionary.get()[t].get().value}setFeatureValue(t,e){let n,s;"string"==typeof e?(n=e,s=a.isStringTruthy.includes(n)):(s=e,n=s?"TRUE":"FALSE");const i=this.dictionary,r=i.get()[t],{value:o,isTruthy:l}=r.get();o.set(n),l.set(s),r.trigger(),i.trigger()}}a.isStringTruthy=["T","TRUE","Y","YES","S","SI","SÃ"];const o=["nice","wrong","correct","victory"],l={nice:["nice.mp3"],wrong:["fweeng.wav"],correct:["success.wav"],victory:["victory-1.wav","victory-2.wav"]};class c{constructor(){this.time=new e(0),this.isPenalized=new e(!1),this.timeInterval=null,this.previousIsPenalized=null}onWindowLoad(){}resetStats(){this.time.set(0),this.timeInterval=setInterval((()=>{this.time.set(this.time.get()+1)}),1e3)}stopTime(){null!==this.timeInterval&&(clearInterval(this.timeInterval),this.timeInterval=null)}getTime(){return this.time}getIsPenalized(){return this.isPenalized}penalize(){null!==this.previousIsPenalized&&(clearTimeout(this.previousIsPenalized),this.previousIsPenalized=null),this.time.set(this.time.get()+c.PENALIZATION_TIME),this.isPenalized.set(!0),this.previousIsPenalized=setTimeout((()=>this.isPenalized.set(!1)),3e3)}}c.PENALIZATION_TIME=15;class d extends HTMLElement{constructor(){super(),this.onClick=()=>{const t=this.getAttribute("card-id");if(null===t||!d.isIdValidRegex.test(t))return;getGameManager().toggleCardSelected(t)},this.attributeChangedCallbackIsClicked=t=>{t.isSelected?this.img.setAttribute("class","card clicked"):this.img.setAttribute("class","card")},this.attributeChangedCallbackClickable=t=>{"true"===t?this.img.addEventListener("mouseup",this.onClick):this.img.removeEventListener("mouseup",this.onClick)},this.root=this.attachShadow({mode:"open"}),this.subscriptions=[];const t=document.createElement("style");t.innerText=d.styles,this.root.appendChild(t),this.img=document.createElement("img"),this.root.appendChild(this.img)}connectedCallback(){const t=this.getAttribute("card-id");if(null===t||!d.isIdValidRegex.test(t))return;const e=getGameManager().getCard(t);if(void 0===e)return;const n=e.subscribeAndRun(this.attributeChangedCallbackIsClicked);this.subscriptions.push(n)}disconnectedCallback(){this.subscriptions.forEach((t=>t())),this.subscriptions=[]}attributeChangedCallback(t,e,n){if(e!==n)switch(t){case"card-id":this.attributeChangedCallbackCardId(n);break;case"clickable":this.attributeChangedCallbackClickable(n)}}attributeChangedCallbackCardId(t){null!==t&&d.isIdValidRegex.test(t)&&i.UpdateCardImg(this.img,t)}}d.observedAttributes=["card-id","clickable"],d.styles=`\n  * {\n    margin: 0;\n    padding: 0;\n  }\n  ${i.CardImgStyle}\n  .clicked {\n    filter: brightness(50%);\n  }\n  `.replaceAll("\n",""),d.isIdValidRegex=/^[0-2]{4}$/,customElements.define("card-displayer",d);class h extends HTMLElement{constructor(){super(),this.renderAllCards=t=>{for(;this.container.lastChild;)this.container.removeChild(this.container.lastChild);t.forEach((t=>{const e=document.createElement("card-displayer");e.setAttribute("card-id",t.id),e.setAttribute("clickable","true"),this.container.appendChild(e)}))},this.root=this.attachShadow({mode:"open"}),this.subscriptions=[];const t=document.createElement("style");t.innerText=h.styles,this.root.appendChild(t),this.container=document.createElement("div"),this.container.setAttribute("class","container"),this.root.appendChild(this.container)}connectedCallback(){const t=getGameManager().getCards();this.subscriptions.forEach((t=>t())),this.subscriptions=[];const e=t.subscribeAndRun((t=>{const e=t.map((t=>t.get()));this.renderAllCards(e)}));this.subscriptions.push(e)}disconnectedCallBack(){this.subscriptions.forEach((t=>t())),this.subscriptions=[]}}h.styles="\n  * {\n    margin: 0;\n    padding: 0;\n  }\n  .container {\n    display: grid;\n    grid-template-columns: var(--card-w) var(--card-w) var(--card-w);\n    grid-template-rows: repeat(100, var(--card-h));\n    grid-gap: 10px;\n    padding: 10px;\n  }\n  ".replaceAll("\n",""),customElements.define("board-displayer",h);class u extends HTMLElement{constructor(){super(),this.root=this.attachShadow({mode:"open"}),this.subscriptions=[];const t=document.createElement("style");t.innerText=u.styles,this.root.appendChild(t),this.container=document.createElement("div"),this.container.setAttribute("class","container"),this.root.appendChild(this.container);const e=document.createElement("board-displayer");this.container.appendChild(e);const n=document.createElement("div");n.setAttribute("class","menu"),this.container.appendChild(n),this.totalSetsP=document.createElement("p"),n.appendChild(this.totalSetsP);const s=document.createElement("clock-displayer");n.appendChild(s);const i=document.createElement("found-sets-displayer");n.appendChild(i);const r=document.createElement("play-again-button");n.appendChild(r)}connectedCallback(){const t=getGameManager().getSets();this.subscriptions.forEach((t=>t())),this.subscriptions=[];const e=t.subscribeAndRun((t=>{this.totalSetsP.innerText=`${t.length} SET${1!==t.length?"S":""}`}));this.subscriptions.push(e)}disconnectedCallback(){this.subscriptions.forEach((t=>t())),this.subscriptions=[]}attributeChangedCallback(t,e,n){}}u.styles="\n  * {\n    font-family: MightySouly;\n    font-size: 48px;\n\n    margin: 0;\n    padding: 0;\n  }\n  .container {\n    display: flex;\n    flex-direction: row;\n  }\n  p {\n    margin: 5px;\n    width: 100%;\n    max-width: calc(3 * var(--mini-card-w));\n    text-align: center;\n  }\n  ".replaceAll("\n",""),customElements.define("game-displayer",u);class g extends HTMLElement{constructor(){super(),this.root=this.attachShadow({mode:"open"}),this.subscriptions=[];const t=document.createElement("style");t.innerHTML=g.styles,this.root.appendChild(t),this.container=document.createElement("div"),this.container.setAttribute("class","container"),this.root.appendChild(this.container)}connectedCallback(){const t=getGameManager().getFoundSets();this.subscriptions.forEach((t=>t())),this.subscriptions=[];const e=t.subscribeAndRun((t=>{for(;null!==this.container.lastChild;)this.container.removeChild(this.container.lastChild);t.forEach((t=>{t.getCards().forEach((t=>{const e=i.CreateCardImg(t,{isReversed:!0});this.container.appendChild(e)}))}))}));this.subscriptions.push(e)}disconnectedCallback(){this.subscriptions.forEach((t=>t())),this.subscriptions=[]}attributeChangedCallback(t,e,n){}}g.styles=`\n  .container {\n    display: grid;\n    grid-template-columns: var(--mini-card-w) var(--mini-card-w) var(--mini-card-w);\n    grid-gap: 3px;\n    padding: 5px;\n  }\n  ${i.ReversedCardImgStyle()}\n  button{\n    width: max-content;\n    height: max-content;\n  }\n  `.replaceAll("\n",""),customElements.define("found-sets-displayer",g);class p extends HTMLElement{constructor(){super(),this.renderPlayAgainButton=()=>{this.button=document.createElement("button"),this.button.innerHTML="You won!<br>Start again?",this.button.className="play-button",this.button.onmouseup=()=>{getGameManager().initGame()},this.root.appendChild(this.button)},this.root=this.attachShadow({mode:"open"}),this.subscriptions=[];const t=document.createElement("style");t.innerText=p.styles,this.root.appendChild(t);const e=getGameManager(),n=e.getSets(),s=e.getFoundSets().subscribeAndRun((t=>{void 0!==this.button&&(this.root.removeChild(this.button),this.button=void 0),t.length===n.get().length&&this.renderPlayAgainButton()}));this.subscriptions.push(s)}connectedCallback(){}disconnectedCallback(){this.subscriptions.forEach((t=>t())),this.subscriptions=[]}attributeChangedCallback(t,e,n){}}p.styles='\n  * {\n    font-family: MightySouly;\n    font-size: 32px;\n\n    margin: 0;\n    padding: 0;\n  }\n  .play-button {\n    background-color: #3DD1E7;\n    border: 0 solid #E5E7EB;\n    box-sizing: border-box;\n    color: #000000;\n    display: flex;\n    font-family: MightySouly,ui-sans-serif,system-ui,-apple-system,system-ui,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";\n    font-size: 1.25rem;\n    font-weight: 700;\n    justify-content: center;\n    line-height: 1.75rem;\n    padding: .75rem 3rem;\n    position: relative;\n    text-align: center;\n    text-decoration: none #000000 solid;\n    text-decoration-thickness: auto;\n    width: 100%;\n    max-width: calc(3 * var(--mini-card-w));\n    margin: 11px;\n    position: relative;\n    cursor: pointer;\n    transform: rotate(-2deg);\n    user-select: none;\n    -webkit-user-select: none;\n    touch-action: manipulation;\n  }\n  \n  .play-button:focus {\n    outline: 0;\n  }\n  \n  .play-button:after {\n    content: \'\';\n    position: absolute;\n    border: 1px solid #000000;\n    bottom: 4px;\n    left: 4px;\n    width: calc(100% - 1px);\n    height: calc(100% - 1px);\n  }\n  \n  .play-button:hover:after {\n    bottom: 2px;\n    left: 2px;\n  }\n  \n  @font-face {\n    font-family: \'MightySouly\';\n    src: url(\'MightySouly-lxggD.woff2\') format(\'woff2\');\n    src: url(\'MightySouly-lxggD.ttf\') format(\'ttf\');\n  }\n  '.replaceAll("\n",""),customElements.define("play-again-button",p);class m extends HTMLElement{constructor(){super(),this.onClick=()=>{getDialogManager().closeCustomDialog()},this.root=this.attachShadow({mode:"open"});const t=document.createElement("div");t.className="container",t.addEventListener("click",this.onClick),this.root.appendChild(t);const e=document.createElement("style");e.innerText=m.styles,this.root.appendChild(e),this.dialog=document.createElement("dialog"),this.dialog.setAttribute("open","true"),this.dialog.addEventListener("click",this.onClick),this.root.appendChild(this.dialog)}connectedCallback(){}disconnectedCallback(){}attributeChangedCallback(t,e,n){e!==n&&this.renderDialog()}renderDialog(){for(var t,e,n,s,r;null!==this.dialog.lastElementChild;)this.dialog.removeChild(this.dialog.lastElementChild);const a=null!==(t=this.getAttribute("title"))&&void 0!==t?t:"",o=null!==(e=this.getAttribute("message"))&&void 0!==e?e:"",l=null!==(s=null===(n=this.getAttribute("cards"))||void 0===n?void 0:n.split(","))&&void 0!==s?s:[],c=null!==(r=this.getAttribute("border-color"))&&void 0!==r?r:"",d=document.createElement("h1");d.innerHTML=a,this.dialog.appendChild(d),this.createDivider("15px"),l.forEach((t=>{const e=i.CreateCardImg(t,{isReversed:!0});this.dialog.append(e)})),0!==l.length&&this.createDivider("10px");const h=document.createElement("p");h.innerHTML=o,this.dialog.appendChild(h);const u=c?`border-color: ${c};`:"";""!==c&&this.dialog.setAttribute("style",u)}createDivider(t){const e=document.createElement("div");e.setAttribute("style",`width: 0; height: ${t};`),this.dialog.appendChild(e)}}m.observedAttributes=["title","message","cards","border-color"],m.styles=`\n  * {\n    margin: 0;\n    padding; 0;\n\n    text-align: center;\n    font-family: MightySouly;\n  }\n  .container{\n    position: fixed;\n    top: 0%;\n    left: 0%;\n    width: 100%;\n    height: 100%;\n    background-color: #00000050;\n  }\n  dialog{\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    border-radius: 10px;\n    box-shadow: 0 15px 20px -10px rgba(0, 0, 0, 0.1);\n  }\n  ${i.ReversedCardImgStyle(1.5)}\n  h1 {\n    font-size: 48px;\n  }\n  p {\n    font-size: 28px;\n  }\n  @font-face {\n    font-family: 'MightySouly';\n    src: url('MightySouly-lxggD.woff2') format('woff2');\n    src: url('MightySouly-lxggD.ttf') format('ttf');\n  }\n  `.replaceAll("\n",""),customElements.define("custom-dialog",m);class b extends HTMLElement{constructor(){super(),this.renderParagraph=()=>{{const t=this.statsManager.getTime().get(),e=this.statsManager.getIsPenalized().get(),{hours:n,minutes:s,seconds:i}=this.getTimeByCategory(t);this.paragraph.innerText=`${n}:${s}:${i}`,this.error.innerText=e?` +${c.PENALIZATION_TIME} sec`:""}},this.subscriptions=[],this.statsManager=getStatsManager(),this.root=this.attachShadow({mode:"open"});const t=document.createElement("style");t.innerText=b.styles,this.root.appendChild(t),this.paragraph=document.createElement("p"),this.root.appendChild(this.paragraph),this.error=document.createElement("p"),this.error.setAttribute("style","color: red;"),this.root.appendChild(this.error);const e=this.statsManager.getTime().subscribeAndRun(this.renderParagraph),n=this.statsManager.getIsPenalized().subscribeAndRun(this.renderParagraph);this.subscriptions.push(e,n)}connectedCallback(){}disconnectedCallback(){this.subscriptions.forEach((t=>t())),this.subscriptions=[]}attributeChangedCallback(t,e,n){}getTimeByCategory(t){const e=this.timeToString(t%60);t=Math.floor(t/60);const n=this.timeToString(t%60);t=Math.floor(t/60);return{seconds:e,minutes:n,hours:this.timeToString(t)}}timeToString(t){let e=t.toString();return e.length<2&&(e="0"+e),e}}b.styles="\n  * {\n    margin: 0;\n    padding; 0;\n\n    text-align: center;\n    font-family: MightySouly;\n  }\n  p {\n    font-size: 20px;\n  }\n  p:empty::before {\n    content:\"\";\n    display:inline-block;\n  }\n  @font-face {\n    font-family: 'MightySouly';\n    src: url('MightySouly-lxggD.woff2') format('woff2');\n    src: url('MightySouly-lxggD.ttf') format('ttf');\n  }\n  ".replaceAll("\n",""),customElements.define("clock-displayer",b);const f=new a;globalThis.getFeaturesManager=()=>f;const C=new class{constructor(t){this.loadClip=t=>{l[t].forEach((e=>{const n=document.createElement("audio"),s=document.createElement("source");s.setAttribute("src","audio/"+e),s.setAttribute("type","audio/mpeg"),n.appendChild(s),document.body.appendChild(n),this.audioClip[t].push(n)}))},this.featuresManager=t,this.audioClip={},o.forEach((t=>this.audioClip[t]=[]))}onWindowLoad(){o.forEach(this.loadClip)}play(t){if(!this.featuresManager.isFeatureEnabled("AUDIO").get())return;const e=this.audioClip[t],n=e[Math.floor(e.length*Math.random())].cloneNode(!0);document.body.appendChild(n),n.addEventListener("ended",(()=>{document.body.removeChild(n)})),n.play()}}(f);globalThis.getAudioManager=()=>C;const y=new class{onWindowLoad(){}displayError(t,e,n){this.CustomDialog=document.createElement("custom-dialog"),this.CustomDialog.setAttribute("title",t),this.CustomDialog.setAttribute("message",e),this.CustomDialog.setAttribute("cards",n.join(",")),this.CustomDialog.setAttribute("border-color","red"),document.body.appendChild(this.CustomDialog)}closeCustomDialog(){void 0!==this.CustomDialog&&(document.body.removeChild(this.CustomDialog),this.CustomDialog=void 0)}};globalThis.getDialogManager=()=>y;const E=new c;globalThis.getStatsManager=()=>E;const v=new class{constructor(t,n,i,r){this.updateFeatureFlag=()=>{const t=this.cards.get().map((t=>t.get().id)),e=s.Compress(t);this.featuresManager.setFeatureValue("GAME-ID",e)},this.featuresManager=t,this.audioManager=n,this.dialogManager=i,this.statsManager=r,this.cards=new e([]),this.sets=new e([]),this.foundSets=new e([]),this.cards.subscribe(this.updateFeatureFlag);const a=this.featuresManager.getFeatureValue("GAME-ID").get();if(""===a)this.initGame();else{const t=s.DeCompress(a);this.loadGame(t)}}onWindowLoad(){}initGame(){let t=[],e=[];const n=this.featuresManager.isFeatureEnabled("PREVENT-NO-SOLUTION").get();do{for(t=[];t.length<12;){const e=s.Random();t.every((t=>t!==e))&&t.push(e)}e=this.calculateAllSets(t)}while(n&&0===e.length);this.loadGame(t,e)}loadGame(t,n){const s=t.map((t=>new e({id:t,isSelected:!1})));n=null!=n?n:this.calculateAllSets(t),this.sets.set(n),this.foundSets.set([]),this.cards.set(s),this.statsManager.resetStats()}getCards(){return this.cards}getCard(t){return this.cards.get().find((e=>e.get().id===t))}getSets(){return this.sets}getFoundSets(){return this.foundSets}toggleCardSelected(t){const e=this.cards.get().find((e=>e.get().id===t));void 0!==e&&(e.set({id:t,isSelected:!e.get().isSelected}),this.checkVictory())}checkVictory(){return t(this,void 0,void 0,(function*(){yield new Promise((t=>setTimeout(t,10)));const t=this.cards.get().filter((t=>t.get().isSelected)),e=t.map((t=>t.get().id));if(3!==e.length)return;const s=new n(e);t.forEach((t=>t.set({id:t.get().id,isSelected:!1}))),s.isValid()?this.foundSets.get().some((t=>t.equals(s)))?this.onPlayerError("Already Found",e):(this.foundSets.set([...this.foundSets.get(),s]),this.foundSets.get().length===this.sets.get().length?this.onGameEnd():this.audioManager.play("correct")):this.onPlayerError("Wrong Set",e)}))}onGameEnd(){this.statsManager.stopTime(),this.audioManager.play("victory")}onPlayerError(t,e){const n="Already Found"===t?"You have found these cards already":"These cards do not form a set";this.audioManager.play("wrong"),this.dialogManager.displayError("Already found",n,e),this.statsManager.penalize()}calculateAllSets(t){const e=[];for(let s=0;s<t.length-2;s++)for(let i=s+1;i<t.length-1;i++)for(let r=i+1;r<t.length;r++){const a=new n([t[s],t[i],t[r]]);a.isValid()&&e.push(a)}return e}}(f,C,y,E);globalThis.getGameManager=()=>v,window.onload=function(){f.onWindowLoad(),C.onWindowLoad(),y.onWindowLoad(),E.onWindowLoad(),v.onWindowLoad()};const w=document.createElement("game-displayer");document.body.appendChild(w);
